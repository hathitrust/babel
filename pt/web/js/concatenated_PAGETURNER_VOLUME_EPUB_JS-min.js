/* nanoScrollerJS - v0.7.2
* http://jamesflorentino.github.com/nanoScrollerJS/
* Copyright (c) 2013 James Florentino; Licensed MIT */
(function(g,k,t){var c,l,h,v,d,e,a,n,s,j,w,x,b,m,r,u,i,f,p,o,q;o={paneClass:"pane",sliderClass:"slider",contentClass:"content",iOSNativeScrolling:false,preventPageScrolling:false,disableResize:false,alwaysVisible:false,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null};u="scrollbar";r="scroll";n="mousedown";s="mousemove";w="mousewheel";j="mouseup";m="resize";d="drag";f="up";b="panedown";h="DOMMouseScroll";v="down";p="wheel";e="keydown";a="keyup";i="touchmove";c=k.navigator.appName==="Microsoft Internet Explorer"&&/msie 7./i.test(k.navigator.appVersion)&&k.ActiveXObject;l=null;q=function(){var y,A,z;y=t.createElement("div");A=y.style;A.position="absolute";A.width="100px";A.height="100px";A.overflow=r;A.top="-9999px";t.body.appendChild(y);z=y.offsetWidth-y.clientWidth;t.body.removeChild(y);return z};x=(function(){function y(A,z){this.el=A;this.options=z;l||(l=q());this.$el=g(this.el);this.doc=g(t);this.win=g(k);this.$content=this.$el.children("."+z.contentClass);this.$content.attr("tabindex",0);this.content=this.$content[0];if(this.options.iOSNativeScrolling&&(this.el.style.WebkitOverflowScrolling!=null)){this.nativeScrolling()}else{this.generate()}this.createEvents();this.addEvents();this.reset()}y.prototype.preventScrolling=function(A,z){if(!this.isActive){return}if(A.type===h){if(z===v&&A.originalEvent.detail>0||z===f&&A.originalEvent.detail<0){A.preventDefault()}}else{if(A.type===w){if(!A.originalEvent||!A.originalEvent.wheelDelta){return}if(z===v&&A.originalEvent.wheelDelta<0||z===f&&A.originalEvent.wheelDelta>0){A.preventDefault()}}}};y.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"});this.iOSNativeScrolling=true;this.isActive=true};y.prototype.updateScrollValues=function(){var z;z=this.content;this.maxScrollTop=z.scrollHeight-z.clientHeight;this.contentScrollTop=z.scrollTop;if(!this.iOSNativeScrolling){this.maxSliderTop=this.paneHeight-this.sliderHeight;this.sliderTop=this.contentScrollTop*this.maxSliderTop/this.maxScrollTop}};y.prototype.createEvents=function(){var z=this;this.events={down:function(A){z.isBeingDragged=true;z.offsetY=A.pageY-z.slider.offset().top;z.pane.addClass("active");z.doc.bind(s,z.events[d]).bind(j,z.events[f]);return false},drag:function(A){z.sliderY=A.pageY-z.$el.offset().top-z.offsetY;z.scroll();z.updateScrollValues();if(z.contentScrollTop>=z.maxScrollTop){z.$el.trigger("scrollend")}else{if(z.contentScrollTop===0){z.$el.trigger("scrolltop")}}return false},up:function(A){z.isBeingDragged=false;z.pane.removeClass("active");z.doc.unbind(s,z.events[d]).unbind(j,z.events[f]);return false},resize:function(A){z.reset()},panedown:function(A){z.sliderY=(A.offsetY||A.originalEvent.layerY)-(z.sliderHeight*0.5);z.scroll();z.events.down(A);return false},scroll:function(A){if(z.isBeingDragged){return}z.updateScrollValues();if(!z.iOSNativeScrolling){z.sliderY=z.sliderTop;z.slider.css({top:z.sliderTop})}if(A==null){return}if(z.contentScrollTop>=z.maxScrollTop){if(z.options.preventPageScrolling){z.preventScrolling(A,v)}z.$el.trigger("scrollend")}else{if(z.contentScrollTop===0){if(z.options.preventPageScrolling){z.preventScrolling(A,f)}z.$el.trigger("scrolltop")}}},wheel:function(A){if(A==null){return}z.sliderY+=-A.wheelDeltaY||-A.delta;z.scroll();return false}}};y.prototype.addEvents=function(){var z;this.removeEvents();z=this.events;if(!this.options.disableResize){this.win.bind(m,z[m])}if(!this.iOSNativeScrolling){this.slider.bind(n,z[v]);this.pane.bind(n,z[b]).bind(""+w+" "+h,z[p])}this.$content.bind(""+r+" "+w+" "+h+" "+i,z[r])};y.prototype.removeEvents=function(){var z;z=this.events;this.win.unbind(m,z[m]);if(!this.iOSNativeScrolling){this.slider.unbind();this.pane.unbind()}this.$content.unbind(""+r+" "+w+" "+h+" "+i,z[r])};y.prototype.generate=function(){var B,C,A,z,D;A=this.options;z=A.paneClass,D=A.sliderClass,B=A.contentClass;if(!this.$el.find(""+z).length&&!this.$el.find(""+D).length){this.$el.append('<div class="'+z+'"><div class="'+D+'" /></div>')}this.pane=this.$el.children("."+z);this.slider=this.pane.find("."+D);if(l){C=this.$el.css("direction")==="rtl"?{left:-l}:{right:-l};this.$el.addClass("has-scrollbar")}if(C!=null){this.$content.css(C)}return this};y.prototype.restore=function(){this.stopped=false;this.pane.show();this.addEvents()};y.prototype.reset=function(){var F,G,H,A,B,z,D,C,E;if(this.iOSNativeScrolling){this.contentHeight=this.content.scrollHeight;return}if(!this.$el.find("."+this.options.paneClass).length){this.generate().stop()}if(this.stopped){this.restore()}F=this.content;H=F.style;A=H.overflowY;if(c){this.$content.css({height:this.$content.height()})}G=F.scrollHeight+l;z=this.pane.outerHeight();C=parseInt(this.pane.css("top"),10);B=parseInt(this.pane.css("bottom"),10);D=z+C+B;E=Math.round(D/G*D);if(E<this.options.sliderMinHeight){E=this.options.sliderMinHeight}else{if((this.options.sliderMaxHeight!=null)&&E>this.options.sliderMaxHeight){E=this.options.sliderMaxHeight}}if(A===r&&H.overflowX!==r){E+=l}this.maxSliderTop=D-E;this.contentHeight=G;this.paneHeight=z;this.paneOuterHeight=D;this.sliderHeight=E;this.slider.height(E);this.events.scroll();this.pane.show();this.isActive=true;if((F.scrollHeight===F.clientHeight)||(this.pane.outerHeight(true)>=F.scrollHeight&&A!==r)){this.pane.hide();this.isActive=false}else{if(this.el.clientHeight===F.scrollHeight&&A===r){this.slider.hide()}else{this.slider.show()}}this.pane.css({visibility:(this.options.alwaysVisible?"visible":"")});return this};y.prototype.scroll=function(){if(!this.isActive){return}this.sliderY=Math.max(0,this.sliderY);this.sliderY=Math.min(this.maxSliderTop,this.sliderY);this.$content.scrollTop((this.paneHeight-this.contentHeight+l)*this.sliderY/this.maxSliderTop*-1);if(!this.iOSNativeScrolling){this.slider.css({top:this.sliderY})}return this};y.prototype.scrollBottom=function(z){if(!this.isActive){return}this.reset();this.$content.scrollTop(this.contentHeight-this.$content.height()-z).trigger(w);return this};y.prototype.scrollTop=function(z){if(!this.isActive){return}this.reset();this.$content.scrollTop(+z).trigger(w);return this};y.prototype.scrollTo=function(z){if(!this.isActive){return}this.reset();this.scrollTop(g(z).get(0).offsetTop);return this};y.prototype.stop=function(){this.stopped=true;this.removeEvents();this.pane.hide();return this};y.prototype.flash=function(){var z=this;if(!this.isActive){return}this.reset();this.pane.addClass("flashed");setTimeout(function(){z.pane.removeClass("flashed")},this.options.flashDelay);return this};return y})();g.fn.nanoScroller=function(y){return this.each(function(){var z,A;if(!(A=this.nanoscroller)){z=g.extend({},o,y);this.nanoscroller=A=new x(this,z)}if(y&&typeof y==="object"){g.extend(A.options,y);if(y.scrollBottom){return A.scrollBottom(y.scrollBottom)}if(y.scrollTop){return A.scrollTop(y.scrollTop)}if(y.scrollTo){return A.scrollTo(y.scrollTo)}if(y.scroll==="bottom"){return A.scrollBottom(0)}if(y.scroll==="top"){return A.scrollTop(0)}if(y.scroll&&y.scroll instanceof g){return A.scrollTo(y.scroll)}if(y.stop){return A.stop()}if(y.flash){return A.flash()}}return A.reset()})}})(jQuery,window,document);
/* /htapps/roger.babel/pt/web/js/jquery.nanoscroller-min.js */
(function(){var a,b;a=this.jQuery||window.jQuery;b=a(window);a.fn.stick_in_parent=function(d){var l,m,j,f,k,e,c,i,h,g,n;if(d==null){d={}}i=d.sticky_class,j=d.inner_scrolling,c=d.recalc_every,e=d.parent,k=d.offset_top,f=d.spacer,m=d.bottoming;if(k==null){k=0}if(e==null){e=void 0}if(j==null){j=true}if(i==null){i="is_stuck"}if(m==null){m=true}h=function(s,F,p,o,z,B,x,y){var C,G,q,E,r,v,t,w,A,u,D;if(s.data("sticky_kit")){return}s.data("sticky_kit",true);v=s.parent();if(e!=null){v=v.closest(e)}if(!v.length){throw"failed to find stick parent"}q=false;C=false;u=f!=null?f&&s.closest(f):a("<div />");if(u){u.css("position",s.css("position"))}t=function(){var H,J,I;if(y){return}H=parseInt(v.css("border-top-width"),10);J=parseInt(v.css("padding-top"),10);F=parseInt(v.css("padding-bottom"),10);p=v.offset().top+H+J;o=v.height();if(q){q=false;C=false;if(f==null){s.insertAfter(u);u.detach()}s.css({position:"",top:"",width:"",bottom:""}).removeClass(i);I=true}z=s.offset().top-parseInt(s.css("margin-top"),10)-k;B=s.outerHeight(true);x=s.css("float");if(u){u.css({width:s.outerWidth(true),height:B,display:s.css("display"),"vertical-align":s.css("vertical-align"),"float":x})}if(I){return D()}};t();if(B===o){return}E=void 0;r=k;A=c;D=function(){var J,L,I,H,K;if(y){return}if(A!=null){A-=1;if(A<=0){A=c;t()}}I=b.scrollTop();if(E!=null){L=I-E}E=I;if(q){if(m){H=I+B+r>o+p;if(C&&!H){C=false;s.css({position:"fixed",bottom:"",top:r}).trigger("sticky_kit:unbottom")}}if(I<z){q=false;r=k;if(f==null){if(x==="left"||x==="right"){s.insertAfter(u)}u.detach()}J={position:"",width:"",top:""};s.css(J).removeClass(i).trigger("sticky_kit:unstick")}if(j){K=b.height();if(B+k>K){if(!C){r-=L;r=Math.max(K-B,r);r=Math.min(k,r);if(q){s.css({top:r+"px"})}}}}}else{if(I>z){q=true;J={position:"fixed",top:r};J.width=s.css("box-sizing")==="border-box"?s.outerWidth()+"px":s.width()+"px";s.css(J).addClass(i);if(f==null){s.after(u);if(x==="left"||x==="right"){u.append(s)}}s.trigger("sticky_kit:stick")}}if(q&&m){if(H==null){H=I+B+r>o+p}if(!C&&H){C=true;if(v.css("position")==="static"){v.css({position:"relative"})}return s.css({position:"absolute",bottom:F,top:"auto"}).trigger("sticky_kit:bottom")}}};w=function(){t();return D()};G=function(){y=true;b.off("touchmove",D);b.off("scroll",D);b.off("resize",w);a(document.body).off("sticky_kit:recalc",w);s.off("sticky_kit:detach",G);s.removeData("sticky_kit");s.css({position:"",bottom:"",top:"",width:""});v.position("position","");if(q){if(f==null){if(x==="left"||x==="right"){s.insertAfter(u)}u.remove()}return s.removeClass(i)}};b.on("touchmove",D);b.on("scroll",D);b.on("resize",w);a(document.body).on("sticky_kit:recalc",w);s.on("sticky_kit:detach",G);return setTimeout(D,0)};for(g=0,n=this.length;g<n;g++){l=this[g];h(a(l))}return this}}).call(this);
/* /htapps/roger.babel/pt/web/js/jquery.sticky-kit-min.js */
head.ready(function(){var f;var d;var g;var c;var e;f=$(window);d=$(".sidebar-wrap");g=d.find(".scrollable");if(!d.length){return}if($("body").is(".view-image")||$("body").is(".view-plaintext")){return}HT.x=10;var a=function(){e=$(".navbar-static-top");var l=$(window).height();var k=$(window).height()-e.height()-$(".toolbar-horizontal").outerHeight()-20;var j=$("#scrolling").height();if(k>j){k=j}var i=k-$(".bibLinks").height()-HT.x;console.log("CALCULATING SCROLLABLE HEIGHT",k,j,i);return i};$.subscribe("action.toggle.fullscreen.sidebar",function(){if(d.parent().is(":visible")){console.log("SIDEBAR PARENT IS VISIBLE");d.trigger("sticky_kit:detach");d.stick_in_parent({inner_scrolling:false,offset_top:e.height()+10,recalc_every:500})}else{console.log("SIDEBAR PARENT IS HIDDEN");d.trigger("sticky_kit:detach");d.css("left","auto")}});var b=d.position().left;d.data("original-left",d.position().left);d.on("sticky_kit:stick",function(h){d.css("left","auto")}).on("sticky_kit:unstick",function(h){d.css("left","auto")}).on("sticky_kit:bottom",function(h){d.css("left","auto")}).on("sticky_kit:unbottom",function(h){});f.scroll(function(){var h=d.css("left");if(d.css("position")=="fixed"){if(h=="auto"){h=d.position().left}d.css("left",(-f.scrollLeft()+b)+"px")}else{d.css("left","auto")}});$.subscribe("view.ready.sidebar",function(){d.trigger("sticky_kit:detach");g.height(a());d.stick_in_parent({inner_scrolling:false,offset_top:e.height()+10,recalc_every:500})})});
/* /htapps/roger.babel/pt/web/js/sidebar-min.js */
head.ready(function(){function x(s){$(s).contents().each(function(B,C){if(C.nodeType==1){x(C)}else{if(n<=j){if(n+C.length>=j){t.setStart(C,j-n)}}if(n<=f){if(n+C.length>=f){t.setEnd(C,f-n)}}n=n+C.length}})}var j,f,t,r,n;function i(G,J,C,I){var H=[];var B=C.querySelectorAll("p");for(var D=0;D<B.length;D++){var F=B[D];j=F.innerText.toLowerCase().indexOf(I.toLowerCase());if(j>-1){t=C.ownerDocument.createRange();f=j+I.length;n=0;x(F,j,f);var E=G.cfiFromRange(t);H.push(E)}else{}}return H}console.log("AHOY READER");var y=$("html").data("epub-root");var g="paginated";var u=$("#main").parent();var z=$("#sidebar .scrollable");var d=$("#sidebar .bibLinks");if(d.length){d.css({position:"fixed",width:$("#sidebar").width()-0});z.css({paddingTop:d.outerHeight()+0})}var p;if(location.hash&&location.hash.startsWith("#/6")){p="epubcfi("+location.hash.substr(1)+")";console.log("AHOY STARTING WITH",location.hash,p);location.hash=""}else{if(sessionStorage.getItem("id")==HT.params.id){p="epubcfi("+sessionStorage.getItem("hash").substr(1)+")";console.log("AHOY STARTING WITH SAVED",p)}}var a=cozy.reader("content",{href:y,flow:g});HT.reader=a;var A=$("#action-go-first").parent();cozy.control.pagePrevious({region:"left.sidebar"}).addTo(a);cozy.control.pageNext({region:"right.sidebar"}).addTo(a);if(A.length){cozy.control.pageFirst({container:A.get(0)}).addTo(a);cozy.control.pageLast({container:A.get(0)}).addTo(a)}cozy.control.navigator({region:"bottom.navigator"}).addTo(a);$("#action-go-prev").on("click",function(){a.prev()});$("#action-go-next").on("click",function(){a.next()});var h=function(B){target=a.currentLocation();$("a[data-target].active").removeClass("active");$(B).addClass("active");var s=$(B).data("target");if(s=="scrolled-doc"){manager="continuous"}a.reopen({flow:s})};$("a[data-target=scrolled-doc]").on("click",function(s){s.preventDefault();s.stopPropagation();h(this)});$("a[data-target=paginated]").on("click",function(s){s.preventDefault();s.stopPropagation();h(this)});var q=a.options.text_size||100;var c=q;var w=function(s){q+=(s*20);if(q==200){$("#action-zoom-in").attr("disabled","disabled");$("#action-zoom-out").attr("disabled",null)}else{if(q==40){$("#action-zoom-in").attr("disabled",null);$("#action-zoom-out").attr("disabled","disabled")}else{$("#action-zoom-in").attr("disabled",null);$("#action-zoom-out").attr("disabled",null)}}a.reopen({text_size:q})};$("#action-zoom-in").on("click",function(s){s.preventDefault();s.stopPropagation();w(1)});$("#action-zoom-out").on("click",function(s){s.preventDefault();s.stopPropagation();w(-1)});$("#action-zoom-reset").on("click",function(s){s.preventDefault();s.stopPropagation();q=100;a.reopen({text_size:c})});var b=$("#action-toggle-fullscreen");b.on("click",function(s){if(screenfull.enabled){screenfull.toggle($(".container.page.centered").get(0));$(this).toggleClass("active")}});screenfull.on("change",function(){if(screenfull.isFullscreen){$("body").addClass("fullscreen");b.find(".icomoon-fullscreen").removeClass("icomoon-fullscreen").addClass("icomoon-fullscreen-exit");b.addClas("active")}else{$("body").removeClass("fullscreen");b.find(".icomoon-fullscreen-exit").removeClass("icomoon-fullscreen-exit").addClass("icomoon-fullscreen");b.removeClass("active");setTimeout(function(){$(window).resize()},0)}});var v=function(E,D,C,B){var s=[];$.each(E,function(){if(this.parent==D){s.push([this,C,B])}});return s};var m={};m["default"]=function(s,B,C){s.forEach(function(E){var G=$("<li><a></a></li>").appendTo(C);var F=G.find("a");F.attr("href",E.href);F.text(E.label);if(E.subitems.length){var D=$("<ul></ul>").appendTo(G);m["default"](E.subitems,B+1,D)}})};m.mobile=function(s,B,C){s.forEach(function(E){var G=$("<li><div class='resulttext'><a><span class='offscreen'></span></a><ul class='mdpInnerList'><li><span></span></ul></div></li>").appendTo(C);var F=G.find("a");F.attr("href",E.href);F.find("span").text();var D=G.find(".mdpInnerList span");D.text(E.label);D.css({display:"inline-block","padding-left":(B*5)+"px"});if(E.subitems.length){m.mobile(E.subitems,B+1,$ul)}})};var l=$(".table-of-contents ul");a.on("updateContents",function(B){var s=$("html").is(".mobile")?"mobile":"default";if(B){m[s](B.toc,0,l)}});l.on("click","a",function(B){B.preventDefault();var s=$(this).attr("href");console.log("AHOY GO TO",s);a.gotoPage(s)});var e=HT.params.h;if(e){e=e.split(":")}else{e=[]}var k={};window.DEBUG=window.DEBUG||{};a.on("updateSection",function(B){var s=a._rendition.manager.current();if(!s){return}var C=s.section;if(!k[C.href]){k[C.href]=true;if(true&&s.contents&&e.length>0){e.forEach(function(E){r=s.contents.window.getSelection();var D=s.contents.document.getElementsByTagName("body").item(0);var F=i(s.contents,r,D,E);if(F.length){F.forEach(function(G){a.annotations.highlight(G)})}})}}});var o=$("#permURL").val();a.on("updateSection",function(){sessionStorage.setItem("id",HT.params.id);sessionStorage.setItem("hash",window.location.hash);$("#pageURL").val(o+"?urlappend=%23"+window.location.hash)});a.start(p)});
/* /htapps/roger.babel/pt/web/js/epub_reader-min.js */
