(function(a){if(typeof define==="function"&&define.amd){if(typeof jQuery!=="undefined"){define(["jquery"],a)}else{define([],a)}}else{if(typeof jQuery!=="undefined"){a(jQuery)}else{a()}}})(function(b,e){var q={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},t=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],p={anchor:"fragment"},a={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},l=Object.prototype.toString,s=/^[0-9]+$/;function o(u,x){var z=decodeURI(u),w=a[x||false?"strict":"loose"].exec(z),y={attr:{},param:{},seg:{}},v=14;while(v--){y.attr[t[v]]=w[v]||""}y.param.query=f(y.attr.query);y.param.fragment=f(y.attr.fragment);y.seg.path=y.attr.path.replace(/^\/+|\/+$/g,"").split("/");y.seg.fragment=y.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");y.attr.base=y.attr.host?(y.attr.protocol?y.attr.protocol+"://"+y.attr.host:y.attr.host)+(y.attr.port?":"+y.attr.port:""):"";return y}function m(v){var u=v.tagName;if(typeof u!=="undefined"){return q[u.toLowerCase()]}return u}function c(x,w){if(x[w].length==0){return x[w]={}}var v={};for(var u in x[w]){v[u]=x[w][u]}x[w]=v;return v}function k(y,w,v,z){var u=y.shift();if(!u){if(g(w[v])){w[v].push(z)}else{if("object"==typeof w[v]){w[v]=z}else{if("undefined"==typeof w[v]){w[v]=z}else{w[v]=[w[v],z]}}}}else{var x=w[v]=w[v]||[];if("]"==u){if(g(x)){if(""!=z){x.push(z)}}else{if("object"==typeof x){x[j(x).length]=z}else{x=w[v]=[w[v],z]}}}else{if(~u.indexOf("]")){u=u.substr(0,u.length-1);if(!s.test(u)&&g(x)){x=c(w,v)}k(y,x,u,z)}else{if(!s.test(u)&&g(x)){x=c(w,v)}k(y,x,u,z)}}}}function d(y,x,B){if(~x.indexOf("]")){var A=x.split("["),u=A.length,z=u-1;k(A,y,"base",B)}else{if(!s.test(x)&&g(y.base)){var w={};for(var v in y.base){w[v]=y.base[v]}y.base=w}i(y.base,x,B)}return y}function f(u){return h(String(u).split(/&|;/),function(v,A){try{A=decodeURIComponent(A.replace(/\+/g," "))}catch(x){}var B=A.indexOf("="),z=n(A),w=A.substr(0,z||B),y=A.substr(z||B,A.length),y=y.substr(y.indexOf("=")+1,y.length);if(""==w){w=A,y=""}return d(v,w,y)},{base:{}}).base}function i(x,w,y){var u=x[w];if(e===u){x[w]=y}else{if(g(u)){u.push(y)}else{x[w]=[u,y]}}}function n(x){var u=x.length,w,y;for(var v=0;v<u;++v){y=x[v];if("]"==y){w=false}if("["==y){w=true}if("="==y&&!w){return v}}}function h(y,v){var w=0,u=y.length>>0,x=arguments[2];while(w<u){if(w in y){x=v.call(e,x,y[w],w,y)}++w}return x}function g(u){return Object.prototype.toString.call(u)==="[object Array]"}function j(v){var u=[];for(prop in v){if(v.hasOwnProperty(prop)){u.push(prop)}}return u}function r(u,v){if(arguments.length===1&&u===true){v=true;u=e}v=v||false;u=u||window.location.toString();return{data:o(u,v),attr:function(w){w=p[w]||w;return typeof w!=="undefined"?this.data.attr[w]:this.data.attr},param:function(w){return typeof w!=="undefined"?this.data.param.query[w]:this.data.param.query},fparam:function(w){return typeof w!=="undefined"?this.data.param.fragment[w]:this.data.param.fragment},segment:function(w){if(typeof w==="undefined"){return this.data.seg.path}else{w=w<0?this.data.seg.path.length+w:w-1;return this.data.seg.path[w]}},fsegment:function(w){if(typeof w==="undefined"){return this.data.seg.fragment}else{w=w<0?this.data.seg.fragment.length+w:w-1;return this.data.seg.fragment[w]}}}}if(typeof b!=="undefined"){b.fn.url=function(v){var u="";if(this.length){u=b(this).attr(m(this[0]))||""}return r(u,v)};b.url=r}else{window.purl=r}});
/* /htapps/roger.babel/mb/web/js/purl-min.js */
if(window.console===undefined){window.console={log:function(){}}}var HT=HT||{};HT.track_pageview=function(a){if(window.location.hash){a=$.extend({},{colltype:window.location.hash.substr(1)},a)}var c=$.param(a);if(c){c="?"+c}if(window.pageTacker!==undefined&&window.pageTracker!=null){var b=function(){try{pageTracker._trackPageview(window.location.pathname+c)}catch(d){console.log(d)}};_gaq.push(b)}};HT.track_event=function(a){a=$.extend({},{category:"MB"},a);if(window.pageTracker!==undefined&&window.pageTracker!=null){var b=function(){try{pageTracker._trackEvent(a.category,a.action,a.label,undefined,true)}catch(c){console.log(c)}};_gaq.push(b)}};
/* /htapps/roger.babel/mb/web/js/mb-min.js */
head.ready(function(){$(".tracked").click(function(){var a=$(this).attr("href");pageTracker._trackEvent("cbActions","click","CB - branded "+$(this).text()+" link");setTimeout(function(){window.location.href=a},500);return false})});
/* /htapps/roger.babel/mb/web/js/tracking-min.js */
head.ready(function(){var b=(window.location.protocol=="https:"?"https://encrypted.google.com":"http://books.google.com")+"/books?callback=?";var a=60;$("[data-bookid]").each(function(){var d=$(this);var c=d.data("bookid");$.getJSON(b,{jscmd:"viewapi",bibkeys:c},function(g){if(g.length==0){var f=$('<img class="bookCover" aria-hidden="true" alt=""/>');f.attr("src","/common/unicorn/img/nocover-thumbnail.png");d.append(f)}var e=selectGoogleLink(g,1,1);if(e.thumbnail_url){var f=$('<img class="bookCover" aria-hidden="true" alt=""/>');f.load(function(){f=jQuery(this);owidth=f.attr("width");if(owidth>a){f.attr("width",a);f.attr("height",f.attr("height")*(a/owidth))}d.append(f)}).attr("src",e.thumbnail_url)}else{var f=$('<img class="bookCover" aria-hidden="true" alt=""/>');f.attr("src","/cgi/imgsrv/cover?id="+d.data("hdl"));if(window.location.hash.indexOf("debug=covers")>-1){d.addClass("localCover")}d.append(f)}})})});function getGoogleBookInfo(a,b,f){var g="";var c="";var d="";var h="";if(a.length>0){var e="//books.google.com/books?jscmd=viewapi&bibkeys="+a+"&callback=?";jQuery.getJSON(e,function(j){if(j.length==0){return}var i="";googleLink=selectGoogleLink(j,b,f);if(googleLink.searchNum){jQuery("#ELEC_holdings").append('<tr><th></th><td style="width: 50%;"></td><td>'+googleLink.link+"</td></tr>");jQuery("#dummyElec").show();if(jQuery("#ELEC_"+b).length){jQuery("#ELEC_"+b).replaceWith('<tr><td class="holdingLocation">Electronic Resources</td><td><a href="/Record/'+b+'/Holdings#holdings">See Holdings</a></td>')}else{jQuery("#holdings"+b).append('<tr><td class="holdingLocation">Electronic Resources</td><td>'+googleLink.link+"</td></tr>")}}if(googleLink.thumbnail_url){img=jQuery('<img class="bookCover" aria-hidden="true" alt="">');img.load(function(){img=jQuery(this);owidth=img.attr("width");if(owidth>75){img.attr("width",75);img.attr("height",img.attr("height")*(75/owidth))}jQuery("#GoogleCover_"+b).empty().append(img).show()}).attr("src",googleLink.thumbnail_url)}})}}function getViewRank(a){if(a=="noview"){return 0}if(a=="partial"){return 2}if(a=="full"){return 3}return 0}function selectGoogleLink(f,a,d){var c=[];c.thumbnailImg="";c.link="";c.searchNum="";var b=0;for(num in f){var e=getViewRank(f[num].preview);if(f[num].thumbnail_url){c.thumbnailImg='<img alt="Cover Image" src="'+f[num].thumbnail_url+'">';c.thumbnail_url=f[num].thumbnail_url}if(e>b){if(f[num].thumbnail_url){c.thumbnailImg='<img alt="Cover Image" src="'+f[num].thumbnail_url+'">'}b=e;viewInfo=translateGooglePreview(f[num].preview);c.link='<a class="clickpostlog" ref="googlebook|'+a+"|google|"+d+'" href="'+f[num].preview_url+'" target="fulltext">Google Online ('+viewInfo+")</a>";c.searchNum=num}}return c}function translateGooglePreview(a){if(a=="full"){return("Available Online")}if(a=="noview"){return("Snippet View")}if(a=="partial"){return("Limited View")}return(a)};
/* /htapps/roger.babel/mb/web/js/google_covers-min.js */
head.ready(function(){var f="0";var b="__NEW__";var s="";var a=[];var j=25;var q=$("#c2");var c=$(".errormsg");var v=$(".toolbar.alt");var e=$("#checkAll");var p=$(".select input[type=checkbox]");var h={};function u(w){if(!c.length){c=$('<div class="alert alert-error"></div>').insertAfter(v)}c.text(w).show()}function m(){c.hide().text()}function l(){var w="/cgi/mb";if(location.pathname.indexOf("/shcgi/")>-1){w="/shcgi/mb"}return w}function d(w){var x=[];w.each(function(){x.push($(this).val())});return x}function r(z){var w={};var y=z.split("|");for(var x=0;x<y.length;x++){kv=y[x].split("=");w[kv[0]]=kv[1]}return w}function g(){p.attr("checked",null);e.attr("checked",null)}function k(y){var w=$("select[name=c2]");var x=w.find("option[value='"+y.coll_id+"']");if(!x.length){x=$("<option></option>").val(y.coll_id).text(y.coll_name).appendTo(w);h[y.coll_id]=y.NumAdded}}function i(y){var C=$(".mb-status");if(!C.length){C=$('<div class="mb-status alert alert-success"></div>').prependTo($(".main")).hide()}var D=y.coll_id;var A=y.coll_name;var B='<a href="mb?a=listis;c='+D+'">'+A+"</a>";var E=y.NumAdded;var z=y.NumFailed;var w;var x;if(z>0){x="numFailed items could not be added to your collection,\n "+E+" items were added to "+B}else{if(E>1){x=E+" items were added to "+B}else{x=E+" item was added to "+B}}C.html(x).show();k(y);g()}function o(A,z){var y={movit:true,delit:true,movitnc:true,editc:true};if(!y[A.a]){A.page="ajax"}if(A.page=="ajax"){$.ajax({url:l(),data:$.param(A,true)}).done(function(B){var C=r(B);$(".btn-loading").removeClass("btn-loading");i(C);if(z){z()}})}else{var w=$.extend({},$.url().param(),A);var x=$("<form method='GET'></form>");x.attr("action",l());_.each(_.keys(w),function(C){var B=w[C];B=$.isArray(B)?B:[B];_.each(B,function(D){$("<input type='hidden' />").attr({name:C}).val(D).appendTo(x)})});x.hide().appendTo("body");x.submit()}}function n(x){var w=$.extend({creating:false,label:"Save Changes"},x);var A=new Image();A.src="/common/unicorn/img/throbber.gif";var y=$('<form class="form-horizontal" action="mb"><div class="control-group"><label class="control-label" for="edit-cn">Collection Name</label><div class="controls"><input type="text" class="input-large" maxlength="100" name="cn" id="edit-cn" value="" placeholder="Your collection name" /><span class="label counter" id="edit-cn-count">100</span></div></div><div class="control-group"><label class="control-label" for="edit-desc">Description</label><div class="controls"><textarea id="edit-desc" name="desc" rows="4" maxlength="255" class="input-large" placeholder="Add your collection description."></textarea><span class="label counter" id="edit-desc-count">255</span></div></div><div class="control-group"><div class="controls"><label class="radio inline"><input type="radio" name="shrd" id="edit-shrd-0" value="0" checked="checked" > Private </label><label class="radio inline"><input type="radio" name="shrd" id="edit-shrd-1" value="1" > Public </label></div></div></form>');y.attr("action",l());if(w.cn){y.find("input[name=cn]").val(w.cn)}if(w.desc){y.find("textarea[name=desc]").val(w.desc)}if(w.shrd!=null){y.find("input[name=shrd][value="+w.shrd+"]").attr("checked","checked")}else{if(!HT.login_status.logged_in){y.find("input[name=shrd][value=0]").attr("checked","checked");$('<div class="alert alert-info">Login to create public/permanent collections.</div>').appendTo(y);y.find("input[name=shrd][value=1]").parent().remove()}}if(w.$hidden){w.$hidden.clone().appendTo(y)}else{$("<input type='hidden' name='c' />").appendTo(y).val(w.c);$("<input type='hidden' name='a' />").appendTo(y).val(w.a)}if(w.$selected){w.$selected.clone().attr("type","hidden").appendTo(y)}var z=bootbox.dialog(y,[{label:"Cancel","class":"btn-dismiss"},{label:w.label,"class":"btn-primary",callback:function(){var E=$.trim(y.find("input[name=c]").val());var D=$.trim(y.find("input[name=cn]").val());var C=$.trim(y.find("textarea[name=desc]").val());if(!D){$('<div class="alert alert-error">You must enter a collection name.</div>').appendTo(y);return false}z.find(".btn-primary").addClass("btn-loading");var B={a:w.a,cn:D,desc:C,shrd:y.find("input[name=shrd]:checked").val()};if(w.$selected){B.id=d(w.$selected)}if(E){B.c=E}o(B,function(){z.modal("hide")});return false}}]);z.find("input[type=text],textarea").each(function(){var D=$(this);var C=$("#"+D.attr("id")+"-count");var B=D.attr("maxlength");C.text(B-D.val().length);D.bind("keyup",function(){C.text(B-D.val().length)})})}function t(w,B,A){var x=1000;if(w<=x&&w+B>x){var y;if(B>1){y="these "+B+" items"}else{y="this item"}var z="Note: Your collection contains "+w+" items.  Adding "+y+" to your collection will increase its size to more than 1000 items.  This means your collection will not be searchable until it is indexed, usually within 48 hours.  After that, just newly added items will see this delay before they can be searched. \n\nDo you want to proceed?";bootbox.confirm(z,function(C){if(C){A()}else{$(".btn-loading").removeClass("btn-loading")}})}else{A()}}e.click(function(x){var w=$(this).attr("checked")||null;p.attr("checked",w)});$(".SelectedItemActions button").click(function(B){B.preventDefault();var z=this.id;var C=$(this);m();var D=q.val();var A=q.find("option:selected").text();var w=$(".id:checked");if(w.length==0){u("You must choose an item");return}if((D==f)&&(z=="copyit"||z=="movit"||z=="addI"||z=="addits")){u("You must select a collection.");return}if(D==b){n({creating:true,$selected:w,a:z+"nc"});return}C.addClass("btn-loading");var E=w.length;var x=getCollSizeArray();var y=x[D]||h[D];t(y,E,function(){o({a:z,id:d(w),c2:D})})});$("#trigger-editc").click(function(x){x.preventDefault();var w=$(this);n({a:"editc",cn:w.data("cn"),desc:w.data("desc"),shrd:w.data("shrd"),c:w.data("c")})})});
/* /htapps/roger.babel/mb/web/js/collection_tools-min.js */
head.ready(function(){var b=$("select[name=sz],select[name=sort]");b.each(function(){f(this)});function f(g){g.changed=false;g.onfocus=e;g.onchange=d;g.onkeydown=c;g.onclick=a;return true}function d(l){var g;if(l&&l.value){g=l}else{g=this}if(g.changed||g.value!=g.initValue){var n=window.location.href;var m=n;var h=g.name;var k=m.split(/[;&]/);var n=[];for(var j=0;j<k.length;j++){if(k[j].indexOf(h+"=")<0){n.push(k[j])}}n=n.join(";");n+=";"+h+"="+g.value;window.location.href=n}return false}function a(){this.changed=true}function e(){this.initValue=this.value;return true}function c(i){var j;var k="9";var h="13";var g="27";if(i){j=i}else{j=event}if((j.keyCode==h||j.keyCode==k)&&this.value!=this.initValue){this.changed=true;selectChanged(this)}else{if(j.keyCode==g){this.value=this.initValue}else{this.changed=false}}return true}});
/* /htapps/roger.babel/mb/web/js/search_tools-min.js */
