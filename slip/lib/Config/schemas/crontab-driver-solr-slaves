#
# Solr Large-scale Indexing
#
SHELL=/bin/bash

# Use mysql-sdr and Solr
SDRROOT=/sdr1
SDRDATAROOT=/sdr1

# Do our own mailing
MAILTO=''
TOADDR=pfarber@umich.edu
HOST=slurm-N
RUN=R

# 12 hours
TIMEOUT=43200

#
# sizer-j job - logs size of all shards on HOST: -H$HOST
#
SIZER       = $SDRROOT/slip/index/index-j -r$RUN -H$HOST 2> /tmp/solr-error || /bin/mail -s "[SLIP] critical index-j error ($HOST)" pfarber@umich.edu < /tmp/solr-error; rm /tmp/solr-error

*/1 * * * *  eval $SIZER

#
# optimize-j job - optimizes a given shard
#
OPTIMIZER_1 = $SDRROOT/slip/index/optimize-j -r$RUN -R1 -O -T$TIMEOUT 2> /tmp/solr-error || /bin/mail -s "[SLIP] critical optimize-j error ($HOST shard=1)" pfarber@umich.edu < /tmp/solr-error; rm /tmp/solr-error
OPTIMIZER_2 = $SDRROOT/slip/index/optimize-j -r$RUN -R2 -O -T$TIMEOUT 2> /tmp/solr-error || /bin/mail -s "[SLIP] critical optimize-j error ($HOST shard=2)" pfarber@umich.edu < /tmp/solr-error; rm /tmp/solr-error

*/1 * * * *  eval $OPTIMIZE_1
*/1 * * * *  eval $OPTIMIZE_2

#
# release-j job - release snapshot, and take new ones
#
RELEASER = $SDRROOT/slip/index/release-j -r$RUN 2> /tmp/solr-error || /bin/mail -s "[SLIP] critical release-j error ($HOST)" pfarber@umich.edu < /tmp/solr-error; rm /tmp/solr-error

*/1 * * * *  eval $RELEASER

