---
# =====================================================================
# V_1-specific plugin config
# =====================================================================

mets_pagemeta_xsl: /htd/lib/API/HTD/App/V_1/mets-pagemeta.xsl
mets_meta_xsl:     /htd/lib/API/HTD/App/V_1/mets-meta.xsl

# resource ids, e.g. "meta", must coordinate with da_authorization db
# table.
patterns:
  meta:                 /(meta)/((.*?)\.((___ARK___)|([^/]+)))$
  structure:       /(structure)/((.*?)\.((___ARK___)|([^/]+)))$
  aggregate:       /(aggregate)/((.*?)\.((___ARK___)|([^/]+)))$
  pageimage:       /(pageimage)/((.*?)\.((___ARK___)|(.*)))/(\d+)$
  pageocr:           /(pageocr)/((.*?)\.((___ARK___)|(.*)))/(\d+)$
  pagecoordocr: /(pagecoordocr)/((.*?)\.((___ARK___)|(.*)))/(\d+)$
  pagemeta:         /(pagemeta)/((.*?)\.((___ARK___)|(.*)))/(\d+)$
  pdf:              /(pdf)/((.*?)\.((___ARK___)|(.*)))$

# separate, for readability
ark_pattern:    ark:/13960/(t|fk)\d[a-z\d][a-z\d]\d[a-z\d][a-z\d]\d[a-z\d]

valid_query_params:
  - ip
  - debug
  - v
  - alt
  - callback
  - oauth_consumer_key
  - oauth_nonce
  - oauth_signature
  - oauth_signature_method
  - oauth_timestamp
  - oauth_version
  - format
  - width
  - height
  - size
  - res
  - watermark

client_query_params:
  - ip
  - debug
  - v
  - alt
  - callback
  - format
  - width
  - height
  - size
  - res
  - watermark

# ---------------------------------------------------------------------
# These are access_keys that may have 'ip' query parameter or regexp
# match constraints from clients acting as a proxies for true clients
# either directly (Data API web client) or indirectly (Qual)
# ---------------------------------------------------------------------
client_key_authorization_list:
  - b2bd9a3cfb
  - 96da6713b2
  - 30080887e8
  - 4bf820e6e7
  - 72e0e7efd3
  - 5dd746bfd3

force_array_format:
  - link
  - htd:pgmap
  - htd:seqmap
  - htd:access

responses:
# ---------------------------------------------------------------------
# structure XML response
# ---------------------------------------------------------------------
  structure:
    entry:
      attrs:
        xmlns: _HTD_ATOM_NAMESPACE_URI_
        xmlns:htd: _HTD_SCHEMAS_URI_
      content:
        htd:rights:
          attrs: null
          content:
            htd:source:
              attrs: null
              content: :::SOURCE
            htd:namespace:
              attrs: null
              content: :::NAMESPACE
            htd:time:
              attrs: null
              content: :::TIME
            htd:user:
              attrs: null
              content: :::USER
            htd:reason:
              attrs: null
              content: :::REASON
            htd:id:
              attrs: null
              content: :::ID
            htd:attr:
              attrs: null
              content: :::ATTR
            htd:note:
              attrs: null
              content: :::NOTE
        htd:version:
          attrs: null
          content: 1
        htd:access_use_statement:
          attrs: null
          content: :::ACCESSUSESTATEMENT
        htd:access_use:
          attrs: null
          content: _HTD_SCHEMAS_URI_#:::ACCESSUSE
        htd:access:
          - attrs:
              resource: pageocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEOCR
          - attrs:
              resource: pagecoordocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGECOORDOCR
          - attrs:
              resource: pageimage
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEIMAGE
          - attrs:
              resource: aggregate
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADAGGREGATE
        updated:
          attrs: null
          content: :::UPDATED
        id:
          attrs: null
          content: _HTD_SCHEMAS_URI_/structure/__ID__
        title:
          attrs: null
          content: HathiTrust Repository Data API - METS
        link:
          - attrs:
              rel: alternate
              href: _HTD_PT_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel: alternate
              href: _HTD_HDL_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel: self
              href: _HTD_STRUCTURE_URI_/structure/__ID__
              type: application/xml
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#aggregate
              href: _HTD_AGGREGATE_URI_/aggregate/__ID__
              type: application/zip
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#meta
              type: application/xml
              href: _HTD_META_URI_/meta/__ID__
            content: null
        xi:include:
          attrs:
            xmlns:xi: http://www.w3.org/2001/XInclude
            href: :::XINCLUDEMETS
          content: null

# ---------------------------------------------------------------------
# meta XML response
# ---------------------------------------------------------------------
  meta:
    entry:
      attrs:
        xmlns: _HTD_ATOM_NAMESPACE_URI_
        xmlns:htd: _HTD_SCHEMAS_URI_
      content:
        htd:rights:
          attrs: null
          content:
            htd:source:
              attrs:   null
              content: :::SOURCE
            htd:namespace:
              attrs:   null
              content: :::NAMESPACE
            htd:time:
              attrs:   null
              content: :::TIME
            htd:user:
              attrs:   null
              content: :::USER
            htd:reason:
              attrs:   null
              content: :::REASON
            htd:id:
              attrs:   null
              content: :::ID
            htd:attr:
              attrs:   null
              content: :::ATTR
            htd:note:
              attrs:   null
              content: :::NOTE
        htd:version:
          attrs:   null
          content: 1
        htd:access_use_statement:
          attrs: null
          content: :::ACCESSUSESTATEMENT
        htd:access_use:
          attrs: null
          content: _HTD_SCHEMAS_URI_#:::ACCESSUSE
        htd:access:
          - attrs:
              resource: pageocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEOCR
          - attrs:
              resource: pagecoordocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGECOORDOCR
          - attrs:
              resource: pageimage
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEIMAGE
          - attrs:
              resource: aggregate
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADAGGREGATE
        updated:
          attrs:   null
          content: :::UPDATED
        id:
          attrs:   null
          content: _HTD_META_URI_/meta/__ID__
        title:
          attrs: null
          content: HathiTrust Repository Data API - metadata
        link:
          - attrs:
              rel:  alternate
              href: _HTD_PT_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel:  alternate
              href: _HTD_HDL_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel:  self
              href: _HTD_META_URI_/meta/__ID__
              type: application/atom+xml
            content: null
          - attrs:
              rel:  _HTD_SCHEMAS_URI_#aggregate
              href: _HTD_AGGREGATE_URI_/aggregate/__ID__
              type: application/zip
            content: null
          - attrs:
              rel:  _HTD_SCHEMAS_URI_#structure
              type: application/xml
              href: _HTD_STRUCTURE_URI_/structure/__ID__
            content: null
        xi:include:
          attrs:
            xmlns:xi: http://www.w3.org/2001/XInclude
            href:     :::XINCLUDEMETS
          content: null

# ---------------------------------------------------------------------
# pagemeta XML response
# ---------------------------------------------------------------------
  pagemeta:
    entry:
      attrs:
        xmlns: _HTD_ATOM_NAMESPACE_URI_
        xmlns:htd: _HTD_SCHEMAS_URI_
      content:
        htd:rights:
          attrs: null
          content:
            htd:source:
              attrs: null
              content: :::SOURCE
            htd:namespace:
              attrs: null
              content: :::NAMESPACE
            htd:time:
              attrs: null
              content: :::TIME
            htd:user:
              attrs: null
              content: :::USER
            htd:reason:
              attrs: null
              content: :::REASON
            htd:id:
              attrs: null
              content: :::ID
            htd:attr:
              attrs: null
              content: :::ATTR
            htd:note:
              attrs: null
              content: :::NOTE
        htd:selected_seq:
          attrs: null
          content: __SEQ__
        htd:version:
          attrs: null
          content: 1
        htd:access_use_statement:
          attrs: null
          content: :::ACCESSUSESTATEMENT
        htd:access_use:
          attrs: null
          content: _HTD_SCHEMAS_URI_#:::ACCESSUSE
        htd:access:
          - attrs:
              resource: pageocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEOCR
          - attrs:
              resource: pagecoordocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGECOORDOCR
          - attrs:
              resource: pageimage
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEIMAGE
          - attrs:
              resource: aggregate
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADAGGREGATE
        updated:
          attrs: null
          content: :::UPDATED
        id:
          attrs: null
          content: _HTD_PAGEMETA_URI_/pagemeta/__ID__/__SEQ__
        title:
          attrs: null
          content: HathiTrust Repository Data API - single page metadata
        link:
          - attrs:
              rel: alternate
              href: _HTD_PT_ALTERNATE_URI_;seq=__SEQ__
              type: text/html
            content: null
          - attrs:
              rel: alternate
              href: _HTD_HDL_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel: self
              href: _HTD_PAGEMETA_URI_/pagemeta/__ID__/__SEQ__
              type: application/atom+xml
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#pageimage
              href: _HTD_PAGEIMAGE_URI_/pageimage/__ID__/__SEQ__
              type: :::IMAGEMIMETYPE
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#pageocr
              href: _HTD_PAGEOCR_URI_/pageocr/__ID__/__SEQ__
              type: :::OCRMIMETYPE
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#pagecoordocr
              href: _HTD_PAGEOCR_URI_/pagecoordocr/__ID__/__SEQ__
              type: :::COORDOCRMIMETYPE
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#aggregate
              href: _HTD_AGGREGATE_URI_/aggregate/__ID__
              type: application/zip
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#structure
              type: application/xml
              href: _HTD_STRUCTURE_URI_/structure/__ID__
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#meta
              type: application/atom+xml
              href: _HTD_META_URI_/meta/__ID__
            content: null
        xi:include:
          attrs:
            xmlns:xi: http://www.w3.org/2001/XInclude
            href: :::XINCLUDEMETS
          content: null


# ---------------------------------------------------------------------
# HTTP status messages
# ---------------------------------------------------------------------
httpstatus:
  200: 200 OK
  303: 303 SEE OTHER
  400: 400 BAD REQUEST
  401: 401 UNAUTHORIZED
  403: 403 FORBIDDEN
  404: 404 NOT FOUND
  405: 405 METHOD NOT ALLOWED
  500: 500 INTERNAL SERVER ERROR
  503: 503 SERVICE UNAVAILABLE


# ---------------------------------------------------------------------
# Variants of extension and format mapped to cannonical_key
# ---------------------------------------------------------------------
extension_format_map:
  default: default
  jpg:     jpeg
  jpeg:    jpeg
  jpe:     jpeg
  jp2:     jp2
  txt:     text
  text:    text
  json:    json
  tif:     tiff
  tiff:    tiff
  zip:     zip
  html:    html
  xml:     xml
  png:     png

# ---------------------------------------------------------------------
# MIME type map: f(resource, representation, cannonical_key)
# ---------------------------------------------------------------------
mimetype_map:
  meta:
    default: application/xml
    json: application/json
  structure:
    default: application/xml
    json: application/json
  pagemeta:
    default: application/xml
    json: application/json
  aggregate:
    default: application/zip
    zip: application/zip
  pageimage:
    tiff: image/tiff
    jp2: image/jp2
    jpeg: image/jpeg
    png: image/png
  pageocr:
    default: text/plain
    text: text/plain
  pagecoordocr:
    default: text/html
    xml: application/xml
    html: text/html
  pdf:
    default: application/pdf

# ---------------------------------------------------------------------
# Access type map: 
# access_type = g(access_key, f(resource, rights attr, source)).
#
# which means that there are further restrictions on 'open' and
# 'restricted' that are applied downstream: 
#
# open pdf is restricted by allow_pdf bit
#
# open pageimage when format=raw|watermark=0 is restricted by the
# allow_raw or allow_unwatermarked_derivatives bit
#
# open_restricted aggregate is restricted by allow_raw bit and
# potentially by CC license rights attribute
#
# ---------------------------------------------------------------------
accessibility_matrix:
  pdf:
    free:
      google: restricted_forbidden
      lit-dlps-dc: open
      um-press: restricted_forbidden
      internet-archive: restricted_forbidden
      yale: restricted_forbidden
      minn-dig-lib: restricted_forbidden
      minn-hist-soc: restricted_forbidden
      utah_state_univ_press: restricted_forbidden
      univ_madrid: restricted_forbidden
      purdue: restricted_forbidden
      getty: restricted_forbidden
      um-dc-mp: restricted_forbidden
    nonfree:
      google: restricted_forbidden
      lit-dlps-dc: restricted_forbidden
      um-press: restricted_forbidden
      internet-archive: restricted
      yale: restricted_forbidden
      minn-dig-lib: restricted_forbidden
      minn-hist-soc: restricted_forbidden
      utah_state_univ_press: restricted
      univ_madrid: restricted_forbidden
      purdue: restricted_forbidden
      getty: restricted_forbidden
      um-dc-mp: restricted_forbidden
  pageimage:
    free:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: restricted_forbidden
      minn-hist-soc: restricted_forbidden
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open
    nonfree:
      google: restricted
      lit-dlps-dc: restricted
      um-press: restricted
      internet-archive: restricted
      yale: restricted
      minn-dig-lib: restricted_forbidden
      minn-hist-soc: restricted_forbidden
      utah_state_univ_press: restricted
      univ_madrid: restricted
      purdue: restricted
      getty: restricted
      um-dc-mp: restricted
  aggregate:
    free:
      google: open_restricted
      lit-dlps-dc: open
      um-press: restricted_forbidden
      internet-archive: open
      yale: open
      minn-dig-lib: restricted_forbidden
      minn-hist-soc: restricted_forbidden
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open
    nonfree:
      google: restricted
      lit-dlps-dc: restricted
      um-press: restricted_forbidden
      internet-archive: restricted
      yale: restricted
      minn-dig-lib: restricted_forbidden
      minn-hist-soc: restricted_forbidden
      utah_state_univ_press: restricted
      univ_madrid: restricted
      purdue: restricted
      getty: restricted
      um-dc-mp: restricted
  pageocr:
    free:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open
    nonfree:
      google: restricted
      lit-dlps-dc: restricted
      um-press: restricted
      internet-archive: restricted
      yale: restricted
      minn-dig-lib: restricted
      minn-hist-soc: restricted
      utah_state_univ_press: restricted
      univ_madrid: restricted
      purdue: restricted
      getty: restricted
      um-dc-mp: restricted
  pagecoordocr:
    free:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open
    nonfree:
      google: restricted
      lit-dlps-dc: restricted
      um-press: restricted
      internet-archive: restricted
      yale: restricted
      minn-dig-lib: restricted
      minn-hist-soc: restricted
      utah_state_univ_press: restricted
      univ_madrid: restricted
      purdue: restricted
      getty: restricted
      um-dc-mp: restricted
  structure:
    free:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open
    nonfree:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open
  meta:
    free:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open
    nonfree:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open
  pagemeta:
    free:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open
    nonfree:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ_press: open
      univ_madrid: open
      purdue: open
      getty: open
      um-dc-mp: open

# ---------------------------------------------------------------------
# Mapping from mdp.rights_current.attr field values to names
# ---------------------------------------------------------------------
rights_name_map:
  1: pd
  2: ic
  3: opb
  4: orph
  5: und
  6: umall
  7: ic-world
  8: nobody
  9: pdus
  10: cc-by
  11: cc-by-nd
  12: cc-by-nc-nd
  13: cc-by-nc
  14: cc-by-nc-sa
  15: cc-by-sa
  16: orphcand
  17: cc-zero
  18: und-world
  19: icus

# ---------------------------------------------------------------------
# List of name that equate to open access modulo geo-location
# ---------------------------------------------------------------------
open_access_names:
  - pd
  - pdus
  - ic-world
  - cc-by
  - cc-by-nd
  - cc-by-nc-nd
  - cc-by-nc
  - cc-by-nc-sa
  - cc-by-sa
  - cc-zero
  - und-world
  - ic-us

# ---------------------------------------------------------------------
# Special treatment for Creative Commons licensed data
# ---------------------------------------------------------------------
creative_commons_names:
  - cc-by
  - cc-by-nd
  - cc-by-nc-nd
  - cc-by-nc
  - cc-by-nc-sa
  - cc-by-sa
  - cc-zero

# ---------------------------------------------------------------------
# Mapping from mdp.rights.source field values to names used in
# accessibility_matrix
# ---------------------------------------------------------------------
sources_name_map:
  1: google
  2: lit-dlps-dc
  3: um-press
  4: internet-archive
  5: yale
  6: minn-dig-lib
  7: minn-hist-soc
  8: utah_state_univ_press
  9: univ_madrid
  10: purdue
  11: getty
  12: um-dc-mp

# ---------------------------------------------------------------------
# Atom elements, contents and attribute values organized by resource
# ---------------------------------------------------------------------
_HTD_META_URI_:           http://babel.hathitrust.org/cgi/htd
_HTD_PAGEMETA_URI_:       http://babel.hathitrust.org/cgi/htd
_HTD_STRUCTURE_URI_:      http://babel.hathitrust.org/cgi/htd
_HTD_PAGEIMAGE_URI_:      :::PAGEIMAGEPROTOCOL://babel.hathitrust.org/cgi/htd
_HTD_PAGEOCR_URI_:        :::PAGEOCRPROTOCOL://babel.hathitrust.org/cgi/htd
_HTD_PAGECOORDOCR_URI_:   :::PAGECOORDOCRPROTOCOL://babel.hathitrust.org/cgi/htd
_HTD_AGGREGATE_URI_:      :::AGGREGATEPROTOCOL://babel.hathitrust.org/cgi/htd
_HTD_SCHEMAS_URI_:        http://schemas.hathitrust.org/htd/2009
_HTD_PT_ALTERNATE_URI_:   http://babel.hathitrust.org/cgi/pt?id=__ID__
_HTD_HDL_ALTERNATE_URI_:  http://hdl.handle.net/2027/__ID__
_HTD_ATOM_NAMESPACE_URI_: http://www.w3.org/2005/Atom

# ---------------------------------------------------------------------
# Token patterns to support dynamic replacement
# ^__XXX__$   replacement by simple substitution
# ^_HTD_[A-Z_]+_$ replacement by substitution by pointer to static data
# ^:::XXX$    replacement by a handler binding
# ---------------------------------------------------------------------
