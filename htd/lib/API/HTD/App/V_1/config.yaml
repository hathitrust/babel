---
# =====================================================================
# V_1-specific plugin config
# =====================================================================

mets_pagemeta_xsl: /htd/lib/API/HTD/App/V_1/mets-pagemeta.xsl
mets_meta_xsl:     /htd/lib/API/HTD/App/V_1/mets-meta.xsl

patterns:
  meta:         /(meta)/((.*?)\.(.*))$
  structure:    /(structure)/((.*?)\.(.*))$
  aggregate:    /(aggregate)/((.*?)\.(.*))$
  pageimage:    /(pageimage)/((.*?)\.(.*))/(\d+)$
  pageocr:      /(pageocr)/((.*?)\.(.*))/(\d+)$
  pagecoordocr: /(pagecoordocr)/((.*?)\.(.*))/(\d+)$
  pagemeta:     /(pagemeta)/((.*?)\.(.*))/(\d+)$

valid_query_params:
  - debug
  - v
  - alt

force_array_format:
  - link
  - htd:pgmap
  - htd:seqmap
  - htd:access

responses:
# ---------------------------------------------------------------------
# structure XML response
# ---------------------------------------------------------------------
  structure:
    entry:
      attrs:
        xmlns: _HTD_ATOM_NAMESPACE_URI_
        xmlns:htd: _HTD_SCHEMAS_URI_
      content:
        htd:rights:
          attrs: null
          content:
            htd:source:
              attrs: null
              content: :::SOURCE
            htd:namespace:
              attrs: null
              content: :::NAMESPACE
            htd:time:
              attrs: null
              content: :::TIME
            htd:user:
              attrs: null
              content: :::USER
            htd:reason:
              attrs: null
              content: :::REASON
            htd:id:
              attrs: null
              content: :::ID
            htd:attr:
              attrs: null
              content: :::ATTR
            htd:note:
              attrs: null
              content: :::NOTE
        htd:version:
          attrs: null
          content: 1
        htd:access_use_statement:
          attrs: null
          content: :::ACCESSUSESTATEMENT
        htd:access_use:
          attrs: null
          content: _HTD_SCHEMAS_URI_#:::ACCESSUSE
        htd:access:
          - attrs:
              resource: pageocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEOCR
          - attrs:
              resource: pagecoordocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGECOORDOCR
          - attrs:
              resource: pageimage
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEIMAGE
          - attrs:
              resource: aggregate
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADAGGREGATE
        updated:
          attrs: null
          content: :::UPDATED
        id:
          attrs: null
          content: _HTD_SCHEMAS_URI_/structure/__ID__
        title:
          attrs: null
          content: HathiTrust Repository Data API - METS
        link:
          - attrs:
              rel: alternate
              href: _HTD_PT_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel: alternate
              href: _HTD_HDL_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel: self
              href: _HTD_STRUCTURE_URI_/structure/__ID__
              type: application/xml
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#aggregate
              href: _HTD_AGGREGATE_URI_/aggregate/__ID__
              type: application/zip
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#meta
              type: application/xml
              href: _HTD_META_URI_/meta/__ID__
            content: null
        xi:include:
          attrs:
            xmlns:xi: http://www.w3.org/2001/XInclude
            href: :::XINCLUDEMETS
          content: null

# ---------------------------------------------------------------------
# meta XML response
# ---------------------------------------------------------------------
  meta:
    entry:
      attrs:
        xmlns: _HTD_ATOM_NAMESPACE_URI_
        xmlns:htd: _HTD_SCHEMAS_URI_
      content:
        htd:rights:
          attrs: null
          content:
            htd:source:
              attrs:   null
              content: :::SOURCE
            htd:namespace:
              attrs:   null
              content: :::NAMESPACE
            htd:time:
              attrs:   null
              content: :::TIME
            htd:user:
              attrs:   null
              content: :::USER
            htd:reason:
              attrs:   null
              content: :::REASON
            htd:id:
              attrs:   null
              content: :::ID
            htd:attr:
              attrs:   null
              content: :::ATTR
            htd:note:
              attrs:   null
              content: :::NOTE
        htd:version:
          attrs:   null
          content: 1
        htd:access_use_statement:
          attrs: null
          content: :::ACCESSUSESTATEMENT
        htd:access_use:
          attrs: null
          content: _HTD_SCHEMAS_URI_#:::ACCESSUSE
        htd:access:
          - attrs:
              resource: pageocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEOCR
          - attrs:
              resource: pagecoordocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGECOORDOCR
          - attrs:
              resource: pageimage
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEIMAGE
          - attrs:
              resource: aggregate
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADAGGREGATE
        updated:
          attrs:   null
          content: :::UPDATED
        id:
          attrs:   null
          content: _HTD_META_URI_/meta/__ID__
        title:
          attrs: null
          content: HathiTrust Repository Data API - metadata
        link:
          - attrs:
              rel:  alternate
              href: _HTD_PT_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel:  alternate
              href: _HTD_HDL_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel:  self
              href: _HTD_META_URI_/meta/__ID__
              type: application/atom+xml
            content: null
          - attrs:
              rel:  _HTD_SCHEMAS_URI_#aggregate
              href: _HTD_AGGREGATE_URI_/aggregate/__ID__
              type: application/zip
            content: null
          - attrs:
              rel:  _HTD_SCHEMAS_URI_#structure
              type: application/xml
              href: _HTD_STRUCTURE_URI_/structure/__ID__
            content: null
        xi:include:
          attrs:
            xmlns:xi: http://www.w3.org/2001/XInclude
            href:     :::XINCLUDEMETS
          content: null

# ---------------------------------------------------------------------
# pagemeta XML response
# ---------------------------------------------------------------------
  pagemeta:
    entry:
      attrs:
        xmlns: _HTD_ATOM_NAMESPACE_URI_
        xmlns:htd: _HTD_SCHEMAS_URI_
      content:
        htd:rights:
          attrs: null
          content:
            htd:source:
              attrs: null
              content: :::SOURCE
            htd:namespace:
              attrs: null
              content: :::NAMESPACE
            htd:time:
              attrs: null
              content: :::TIME
            htd:user:
              attrs: null
              content: :::USER
            htd:reason:
              attrs: null
              content: :::REASON
            htd:id:
              attrs: null
              content: :::ID
            htd:attr:
              attrs: null
              content: :::ATTR
            htd:note:
              attrs: null
              content: :::NOTE
        htd:selected_seq:
          attrs: null
          content: __SEQ__
        htd:version:
          attrs: null
          content: 1
        htd:access_use_statement:
          attrs: null
          content: :::ACCESSUSESTATEMENT
        htd:access_use:
          attrs: null
          content: _HTD_SCHEMAS_URI_#:::ACCESSUSE
        htd:access:
          - attrs:
              resource: pageocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEOCR
          - attrs:
              resource: pagecoordocr
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGECOORDOCR
          - attrs:
              resource: pageimage
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADPAGEIMAGE
          - attrs:
              resource: aggregate
            content: _HTD_SCHEMAS_URI_#:::DOWNLOADAGGREGATE
        updated:
          attrs: null
          content: :::UPDATED
        id:
          attrs: null
          content: _HTD_PAGEMETA_URI_/pagemeta/__ID__/__SEQ__
        title:
          attrs: null
          content: HathiTrust Repository Data API - single page metadata
        link:
          - attrs:
              rel: alternate
              href: _HTD_PT_ALTERNATE_URI_;seq=__SEQ__
              type: text/html
            content: null
          - attrs:
              rel: alternate
              href: _HTD_HDL_ALTERNATE_URI_
              type: text/html
            content: null
          - attrs:
              rel: self
              href: _HTD_PAGEMETA_URI_/pagemeta/__ID__/__SEQ__
              type: application/atom+xml
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#pageimage
              href: _HTD_PAGEIMAGE_URI_/pageimage/__ID__/__SEQ__
              type: :::IMAGEMIMETYPE
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#pageocr
              href: _HTD_PAGEOCR_URI_/pageocr/__ID__/__SEQ__
              type: :::OCRMIMETYPE
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#pagecoordocr
              href: _HTD_PAGEOCR_URI_/pagecoordocr/__ID__/__SEQ__
              type: :::COORDOCRMIMETYPE
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#aggregate
              href: _HTD_AGGREGATE_URI_/aggregate/__ID__
              type: application/zip
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#structure
              type: application/xml
              href: _HTD_STRUCTURE_URI_/structure/__ID__
            content: null
          - attrs:
              rel: _HTD_SCHEMAS_URI_#meta
              type: application/atom+xml
              href: _HTD_META_URI_/meta/__ID__
            content: null
        xi:include:
          attrs:
            xmlns:xi: http://www.w3.org/2001/XInclude
            href: :::XINCLUDEMETS
          content: null

# ---------------------------------------------------------------------
# IP Addresses allowed access to restricted resources
# ---------------------------------------------------------------------
allow_external: 1
allowed_ip_addresses:
  internal:
    - ^141\.211\.175\.29$
    - ^141\.211\.43\.143$
    - ^141\.211\.43\.149$
    - ^141\.211\.43\.163$
    - ^141\.211\.43\.181$
    - ^141\.211\.43\.184$
    - ^141\.211\.43\.185$
    - ^141\.211\.43\.191$
    - ^141\.211\.43\.195$
    - ^141\.211\.43\.211$
    - ^141\.213\.128\.184$
    - ^141\.213\.128\.185$
    - ^141\.213\.128\.186$
    - ^141\.213\.128\.187$
  external:
    - ^192\.35\.209\.(1(2[8-9]|[3-9][0-9])|2([0-4][0-9]|5[0-5]))$
    - ^128\.48\.204\.74$

# ---------------------------------------------------------------------
# HTTP status messages
# ---------------------------------------------------------------------
httpstatus:
  200:  200 OK
  400U: 400 BAD REQUEST Invalid URI
  400H: 400 BAD REQUEST Unsupported request method
  401:  401 UNAUTHORIZED Distinguished Name not registered
  403:  403 FORBIDDEN Authentication required
  403P: 403 FORBIDDEN Invalid protocol
  404:  404 NOT FOUND
  500:  500 INTERNAL SERVER ERROR
  503:  503 SERVICE UNAVAILABLE
  503Q: 503 SERVICE UNAVAILABLE Quota exceeded

# ---------------------------------------------------------------------
# MIME type map: f(resource, representation)
# ---------------------------------------------------------------------
mimetype_map:
  meta:
    default: application/xml
    json: application/json
  structure:
    default: application/xml
    json: application/json
  pagemeta:
    default: application/xml
    json: application/json
  aggregate:
    default: application/zip
    zip: application/zip
  pageimage:
    tiff: image/tiff
    jp2: image/jp2
    jpg: image/jpg
  pageocr:
    default: text/plain
    text: text/plain
  pagecoordocr:
    default: text/html
    xml: application/xml
    html: text/html

# ---------------------------------------------------------------------
# Access type map: f(resource, rights attr, source)
# ---------------------------------------------------------------------
accessibility_matrix:
  pageimage:
    free:
      google: limited
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: restricted
      minn-hist-soc: restricted
      utah_state_univ: open
    nonfree:
      google: restricted
      lit-dlps-dc: restricted
      um-press: restricted
      internet-archive: restricted
      yale: restricted
      minn-dig-lib: restricted
      minn-hist-soc: restricted
      utah_state_univ: restricted
  pageocr:
    free:
      google: limited
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ: open
    nonfree:
      google: restricted
      lit-dlps-dc: restricted
      um-press: restricted
      internet-archive: restricted
      yale: restricted
      minn-dig-lib: restricted
      minn-hist-soc: restricted
      utah_state_univ: restricted
  pagecoordocr:
    free:
      google: limited
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ: open
    nonfree:
      google: restricted
      lit-dlps-dc: restricted
      um-press: restricted
      internet-archive: restricted
      yale: restricted
      minn-dig-lib: restricted
      minn-hist-soc: restricted
      utah_state_univ: restricted
  aggregate:
    free:
      google: free_bulk_restricted
      lit-dlps-dc: open
      um-press: restricted
      internet-archive: open
      yale: open
      minn-dig-lib: restricted
      minn-hist-soc: restricted
      utah_state_univ: open
    nonfree:
      google: restricted
      lit-dlps-dc: restricted
      um-press: restricted
      internet-archive: restricted
      yale: restricted
      minn-dig-lib: restricted
      minn-hist-soc: restricted
      utah_state_univ: restricted
  structure:
    free:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ: open
    nonfree:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ: open
  meta:
    free:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ: open
    nonfree:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ: open
  pagemeta:
    free:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ: open
    nonfree:
      google: open
      lit-dlps-dc: open
      um-press: open
      internet-archive: open
      yale: open
      minn-dig-lib: open
      minn-hist-soc: open
      utah_state_univ: open

# ---------------------------------------------------------------------
# Mapping from mdp.rights_current.attr field values to names
# ---------------------------------------------------------------------
rights_name_map:
  1: pd
  2: ic
  3: opb
  4: orph
  5: und
  6: umall
  7: world
  8: nobody
  9: pdus
  10: cc-by
  11: cc-by-nd
  12: cc-by-nc-nd
  13: cc-by-nc
  14: cc-by-nc-sa
  15: cc-by-sa

# ---------------------------------------------------------------------
# List of name that equate to open access
# ---------------------------------------------------------------------
open_access_names: 
  - pd 
  - pdus 
  - world 
  - cc-by 
  - cc-by-nd 
  - cc-by-nc-nd 
  - cc-by-nc 
  - cc-by-nc-sa 
  - cc-by-sa

# ---------------------------------------------------------------------
# Mapping from mdp.rights.source field values to names used in
# accessibility_matrix
# ---------------------------------------------------------------------
sources_name_map:
  1: google
  2: lit-dlps-dc
  3: um-press
  4: internet-archive
  5: yale
  6: minn-dig-lib
  7: minn-hist-soc
  8: utah_state_univ

# ---------------------------------------------------------------------
# MIME type map
# ---------------------------------------------------------------------
extension_format_map:
  default: default
  jpg:     jpg
  jpeg:    jpg
  jpe:     jpg
  jp2:     jp2
  txt:     text
  json:    json
  tif:     tiff
  tiff:    tiff
  zip:     zip
  html:    html
  xml:     xml

# ---------------------------------------------------------------------
# Atom elements, contents and attribute values organized by resource
# ---------------------------------------------------------------------
_HTD_META_URI_:           http://services.hathitrust.org/htd
_HTD_PAGEMETA_URI_:       http://services.hathitrust.org/htd
_HTD_STRUCTURE_URI_:      http://services.hathitrust.org/htd
_HTD_PAGEIMAGE_URI_:      :::PAGEIMAGEPROTOCOL://services.hathitrust.org/htd
_HTD_PAGEOCR_URI_:        :::PAGEOCRPROTOCOL://services.hathitrust.org/htd
_HTD_PAGECOORDOCR_URI_:   :::PAGECOORDOCRPROTOCOL://services.hathitrust.org/htd
_HTD_AGGREGATE_URI_:      :::AGGREGATEPROTOCOL://services.hathitrust.org/htd
_HTD_SCHEMAS_URI_:        http://schemas.hathitrust.org/htd/2009
_HTD_PT_ALTERNATE_URI_:   http://babel.hathitrust.org/cgi/pt?id=__ID__
_HTD_HDL_ALTERNATE_URI_:  http://hdl.handle.net/2027/__ID__
_HTD_ATOM_NAMESPACE_URI_: http://www.w3.org/2005/Atom

# ---------------------------------------------------------------------
# Token patterns to support dynamic replacement
# ^__XXX__$   replacement by simple substitution
# ^_HTD_[A-Z_]+_$ replacement by substitution by pointer to static data
# ^:::XXX$    replacement by a handler binding
# ---------------------------------------------------------------------
